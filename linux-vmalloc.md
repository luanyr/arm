在 Linux 系统中的每个进程都有独立 4GB 内存空间，而 Linux 把这 4GB 内存空间划分为用户内存空间（0 ~ 3GB）和内核内存空间（3GB ~ 4GB），而内核内存空间由划分为直接内存映射区和动态内存映射区（vmalloc区）。

直接内存映射区从 3GB 开始到 3GB+896MB 处结束，直接内存映射区的特点就是物理地址与虚拟地址的关系为：虚拟地址 = 物理地址 + 3GB。

而动态内存映射区不能通过这种简单的关系关联，而是需要访问动态内存映射区时，由内核动态申请物理内存并且映射到动态内存映射区中。下图是动态内存映射区在内存空间的位置：

![img](https://pic1.zhimg.com/80/v2-33c4056be2df5d21a827bff76dab9290_720w.jpg)

kmalloc和vmalloc是分配的是内核的内存,malloc分配的是用户的内存。kmalloc保证分配的内存在物理上是连续的,vmalloc保证的是在虚拟地址空间上的连续。
kmalloc能分配的大小有限,vmalloc和malloc能分配的大小相对较大。**内存只有在要被DMA访问的时候才需要物理上连续(必须用kmalloc)**。

